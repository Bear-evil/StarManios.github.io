<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <meta name="description" content="美丽总是那么短暂" />
  

  
  
  
  
  
  
  <title>风士魁</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="美丽总是那么短暂">
<meta property="og:type" content="website">
<meta property="og:title" content="风士魁">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="风士魁">
<meta property="og:description" content="美丽总是那么短暂">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风士魁">
<meta name="twitter:description" content="美丽总是那么短暂">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="风士魁" rel="home">风士魁</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">风雨泽－万物苏</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-ios视频直播开发" class="post-ios视频直播开发 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2016/06/12/ios视频直播开发/">ios视频直播开发</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2016/06/12/ios视频直播开发/" data-id="cipc7059o00015fs6uot1yzeq" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p><span></span></p>
<ol>
<li>采集硬件（摄像头）视频图像</li>
</ol>
<p>iOS 的摄像头采集。</p>
<p>首先初始化AVCaptureSession，说到Session，有没有人想到AVAudioSession呢？</p>
<p>// 初始化 AVCaptureSession<br>_session = [[AVCaptureSession alloc] init];<br>设置采集的 Video 和 Audio 格式，这两个是分开设置的，也就是说，你可以只采集视频。<br>/ 配置采集输入源（摄像头）<br>NSError <em>error = nil;<br>// 获得一个采集设备，例如前置/后置摄像头<br>AVCaptureDevice </em>videoDevice = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];<br>// 用设备初始化一个采集的输入对象<br>AVCaptureDeviceInput *videoInput = [AVCaptureDeviceInput deviceInputWithDevice:videoDevice error:&amp;error];<br>if (error) {<br>NSLog(@”Error getting video input device: %@”, error.description);<br>}<br>if ([_session canAddInput:videoInput]) {<br>[_session addInput:videoInput]; // 添加到Session<br>}</p>
<p>// 配置采集输出，即我们取得视频图像的接口<br>_videoQueue = dispatch_queue_create(“Video Capture Queue”, DISPATCH_QUEUE_SERIAL);<br>_videoOutput = [[AVCaptureVideoDataOutput alloc] init];<br>[_videoOutput setSampleBufferDelegate:self queue:_videoQueue];</p>
<p>// 配置输出视频图像格式<br>NSDictionary <em>captureSettings = @{(NSString</em>)kCVPixelBufferPixelFormatTypeKey: @(kCVPixelFormatType_32BGRA)};</p>
<p>_videoOutput.videoSettings = captureSettings;<br>_videoOutput.alwaysDiscardsLateVideoFrames = YES;<br>if ([_session canAddOutput:_videoOutput]) {<br>[_session addOutput:_videoOutput];  // 添加到Session<br>}</p>
<p>// 保存Connection，用于在SampleBufferDelegate中判断数据来源（是Video/Audio？）<br>_videoConnection = [_videoOutput connectionWithMediaType:AVMediaTypeVideo];<br>实现 AVCaptureOutputDelegate：</p>
<ul>
<li>(void) captureOutput:(AVCaptureOutput <em>)captureOutput<br>didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer<br>fromConnection:(AVCaptureConnection </em>)connection<br>{<br>// 这里的sampleBuffer就是采集到的数据了，但它是Video还是Audio的数据，得根据connection来判断<br>if (connection == _videoConnection) {  // Video<br>/<em><br>// 取得当前视频尺寸信息<br>CVPixelBufferRef pixelBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);<br>int width = CVPixelBufferGetWidth(pixelBuffer);<br>int height = CVPixelBufferGetHeight(pixelBuffer);<br>NSLog(@”video width: %d  height: %d”, width, height);
</em>/<br>NSLog(@”在这里获得video sampleBuffer，做进一步处理（编码H.264）”);<br>} else if (connection == _audioConnection) {  // Audio<br>NSLog(@”这里获得audio sampleBuffer，做进一步处理（编码AAC）”);<br>}<br>}<br>关于实时编码H.264和AAC Buffer，这里又是两个技术点，之后再讲吧。</li>
</ul>
<p>配置完成，现在启动 Session：<br>// 启动 Session<br>[_session startRunning];<br>1.1 附加任务：将当前硬件采集视频图像显示到屏幕</p>
<p>很简单，发送端直接使用自家的AVCaptureVideoPreviewLayer显示，so easy<br>_previewLayer = [AVCaptureVideoPreviewLayer layerWithSession:_session];<br>_previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill; // 设置预览时的视频缩放方式<br>[[_previewLayer connection] setVideoOrientation:AVCaptureVideoOrientationPortrait]; // 设置视频的朝向</p>
<p>_previewLayer.frame = self.view.layer.bounds;<br>[self.view.layer addSublayer:_previewLayer];<br></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2016/06/12/ios视频直播开发/">
    <time datetime="2016-06-12T05:45:08.000Z" class="entry-date">
        2016-06-12
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-ios毛玻璃的实现" class="post-ios毛玻璃的实现 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2016/05/25/ios毛玻璃的实现/">ios毛玻璃的实现</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2016/05/25/ios毛玻璃的实现/" data-id="cipc7059i00005fs6t4te8wkp" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p><span>其实在iOS7.0(包括)之前还是有系统的类可以实现毛玻璃效果的, 就是 UIToolbar这个类,并且使用相当简单,几行代码就可以搞定.</span></p>
<p>下面是代码实现:</p>
<p>创建一个UIToolbar实例,设置它的frame或者也可以通过添加约束</p>
<p>然后UIToolbar有一个属性:barStyle,设置对应的枚举值来呈现 毛玻璃的样式,最后再添加到需要进行毛玻璃效果的view上即可.<br>1 /<em><br>2      毛玻璃的样式(枚举)<br>3      UIBarStyleDefault          = 0,<br>4      UIBarStyleBlack            = 1,<br>5      UIBarStyleBlackOpaque      = 1, // Deprecated. Use UIBarStyleBlack<br>6      UIBarStyleBlackTranslucent = 2, // Deprecated. Use UIBarStyleBlack and set the translucent property to YES<br>7     </em>/<br>8     UIImageView <em>bgImgView = [[UIImageView alloc] initWithFrame:self.view.bounds];<br>9     bgImgView.image = [UIImage imageNamed:@”huoying4.jpg”];<br>10     [self.view addSubview:bgImgView];<br>11<br>12     UIToolbar </em>toolbar = [[UIToolbar alloc] initWithFrame:CGRectMake(0, 0, bgImgView.frame.size.width*0.5, bgImgView.frame.size.height)];<br>13     toolbar.barStyle = UIBarStyleBlackTranslucent;<br>14     [bgImgView addSubview:toolbar];</p>
<p></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2016/05/25/ios毛玻璃的实现/">
    <time datetime="2016-05-25T03:04:37.000Z" class="entry-date">
        2016-05-25
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-音频直播的难点总结" class="post-音频直播的难点总结 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2016/05/25/音频直播的难点总结/">音频直播的难点总结</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2016/05/25/音频直播的难点总结/" data-id="cipc705a500045fs6bphwzcwb" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p></p><h1>音频直播的难点总结</h1><p></p>
<p>链接】ios多音频混合<br><a href="http://blog.csdn.net/zengconggen/article/details/7842076" target="_blank" rel="external">http://blog.csdn.net/zengconggen/article/details/7842076</a><br>李居豪  10:19:07<br>【链接】音频框架TheAmazingAudioEngine实现音效<br><a href="http://www.cocoachina.com/ios/20160201/15176.html" target="_blank" rel="external">http://www.cocoachina.com/ios/20160201/15176.html</a><br>李居豪  10:19:18<br><a href="https://github.com/TheAmazingAudioEngine/TheAmazingAudioEngine" target="_blank" rel="external">https://github.com/TheAmazingAudioEngine/TheAmazingAudioEngine</a><br>李居豪  10:19:34<br>【链接】ios视频和音频的合成<br><a href="http://www.tuicool.com/articles/bQzEr23" target="_blank" rel="external">http://www.tuicool.com/articles/bQzEr23</a></p>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2016/05/25/音频直播的难点总结/">
    <time datetime="2016-05-25T02:10:53.000Z" class="entry-date">
        2016-05-25
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-菜鸟成神宝典" class="post-菜鸟成神宝典 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2015/10/01/菜鸟成神宝典/">菜鸟成神宝典</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2015/10/01/菜鸟成神宝典/" data-id="cipc705ae00065fs6g2iogi3d" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p></p><h1>菜鸟成神宝典</h1><p></p>
<p> （一）类与对象 <a href="http://blog.jobbole.com/79566/" target="_blank" rel="external">http://blog.jobbole.com/79566/</a><br><br>（二）成员变量和属性 <a href="http://blog.jobbole.com/79570/" target="_blank" rel="external">http://blog.jobbole.com/79570/</a><br><br>（三）消息和方法 <a href="http://blog.jobbole.com/79574/" target="_blank" rel="external">http://blog.jobbole.com/79574/</a><br><br>（四）Method Swizzling <a href="http://blog.jobbole.com/79580/" target="_blank" rel="external">http://blog.jobbole.com/79580/</a><br><br>（五）协议与分类 <a href="http://blog.jobbole.com/79583/" target="_blank" rel="external">http://blog.jobbole.com/79583/</a><br><br>（六）补充 <a href="http://blog.jobbole.com/79588/" target="_blank" rel="external">http://blog.jobbole.com/79588/</a><br><br><br><br>内存管理教程和原理剖析（一）<a href="http://blog.jobbole.com/66197/" target="_blank" rel="external">http://blog.jobbole.com/66197/</a><br><br>内存管理教程和原理剖析（二）<a href="http://blog.jobbole.com/66363/" target="_blank" rel="external">http://blog.jobbole.com/66363/</a><br><br>内存管理教程和原理剖析（三）<a href="http://blog.jobbole.com/66369/" target="_blank" rel="external">http://blog.jobbole.com/66369/</a><br><br>内存管理教程和原理剖析（四）<a href="http://blog.jobbole.com/66372/" target="_blank" rel="external">http://blog.jobbole.com/66372/</a><br><br>深浅拷贝 <a href="http://ios.jobbole.com/84859/" target="_blank" rel="external">http://ios.jobbole.com/84859/</a><br><br><br><br><br><br>10分钟 搞定JS和iOS的交互<br><br><br>你必须先看这篇文章： <a href="http://www.open-open.com/lib/view/open1419305655562.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1419305655562.html</a><br><br><a href="http://blog.csdn.net/lizhongfu2013/article/details/9232129" target="_blank" rel="external">http://blog.csdn.net/lizhongfu2013/article/details/9232129</a><br><br><a href="http://blog.csdn.net/lizhongfu2013/article/details/9236357" target="_blank" rel="external">http://blog.csdn.net/lizhongfu2013/article/details/9236357</a><br><br>干货好文章 <a href="http://www.jianshu.com/p/a329cd4a67ee" target="_blank" rel="external">http://www.jianshu.com/p/a329cd4a67ee</a><br><br>干货好文章 <a href="http://ios.jobbole.com/84491/" target="_blank" rel="external">http://ios.jobbole.com/84491/</a><br><br>交互范例 ：<a href="http://www.open-open.com/lib/view/open1463553967635.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1463553967635.html</a><br><br><a href="http://www.open-open.com/lib/view/open1456311816823.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1456311816823.html</a><br><br></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2015/10/01/菜鸟成神宝典/">
    <time datetime="2015-09-30T17:13:03.000Z" class="entry-date">
        2015-10-01
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-如何做一个面霸" class="post-如何做一个面霸 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2015/09/24/如何做一个面霸/">如何做一个面霸</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2015/09/24/如何做一个面霸/" data-id="cipc705a300035fs6ff8kkzu5" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p></p><h1>如何做一个面霸</h1><p></p>
<p></p><br><h2>风雨泽§万物苏</h2><br><p>1.<a href="http://www.open-open.com/lib/view/open1440165855942.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1440165855942.html</a> 面试大全从简单到复杂(简单篇)</p><br><p>2.<a href="http://zhangmingwei.iteye.com/blog/1748431" target="_blank" rel="external">http://zhangmingwei.iteye.com/blog/1748431</a> 史上最全的iOS面试题及答案<br></p><br><p>3.<a href="http://www.open-open.com/lib/view/open1460681498043.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1460681498043.html</a> 面试实战1</p><br><p>4.<a href="http://www.open-open.com/lib/view/open1460681420544.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1460681420544.html</a> 面试实战2</p><br><p>5.<a href="http://www.open-open.com/lib/view/open1460682694966.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1460682694966.html</a> 面试实战3<br></p><br><p>6.<a href="http://ios.jobbole.com/84919/" target="_blank" rel="external">http://ios.jobbole.com/84919/</a> runtime面试题看我你就足够了<br></p><br><p>7.<a href="http://www.open-open.com/lib/view/open1382923236124.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1382923236124.html</a> ios面试题汇总</p><br><p>8.<a href="https://github.com/ChenYilong/iOSInterviewQuestions" target="_blank" rel="external">https://github.com/ChenYilong/iOSInterviewQuestions</a> 太阳神的面试题，一个靠谱工程师必备宝典<br></p><br><p>9.<a href="http://www.open-open.com/lib/view/open1457952546563.html优酷的面试题" target="_blank" rel="external">http://www.open-open.com/lib/view/open1457952546563.html优酷的面试题</a></p><br><p>10.<a href="http://www.open-open.com/lib/view/open1456359620073.html宝库的面试题" target="_blank" rel="external">http://www.open-open.com/lib/view/open1456359620073.html宝库的面试题</a></p><br><p>11.<a href="http://www.open-open.com/lib/view/open1454028502198.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1454028502198.html</a> 多线程面试必看</p><br><p>12.<a href="http://www.cocoachina.com/programmer/20151019/13746.html" target="_blank" rel="external">http://www.cocoachina.com/programmer/20151019/13746.html</a> iOS综合面试题</p><br><p>13.<a href="http://www.90159.com/2015/07/26/71/" target="_blank" rel="external">http://www.90159.com/2015/07/26/71/</a> 程序员头条面试题集锦</p><br><p>14.<a href="http://www.henishuo.com/objective-c-base-interview/" target="_blank" rel="external">http://www.henishuo.com/objective-c-base-interview/</a> iOS笔试题<br></p><br><p>15.<a href="http://www.henishuo.com/ios-interview-entrance/" target="_blank" rel="external">http://www.henishuo.com/ios-interview-entrance/</a> 必看，必考面试大全<br></p><br><p>16.<a href="http://www.henishuo.com/nanjing-jingdong-interview/" target="_blank" rel="external">http://www.henishuo.com/nanjing-jingdong-interview/</a> 京东面试题</p>



      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2015/09/24/如何做一个面霸/">
    <time datetime="2015-09-24T07:01:56.000Z" class="entry-date">
        2015-09-24
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-collectionView" class="post-collectionView post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2015/06/24/collectionView/">collectionView</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2015/06/24/collectionView/" data-id="cipc705aa00055fs6h8nss94w" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>iOS流布局UICollectionView系列六——将布局从平面应用到空间</p>
<h1>iOS流布局UICollectionView系列六——将布局从平面应用到空间</h1>

<p>先来实现一个炫酷的滚轮空间布局</p>
<p>万丈的高楼也是由一砖一瓦堆砌而成，在我们完全模拟系统pickerView前，我们应该先将视图的布局摆放这一问题解决。我们依然来创建一个类，继承于UICollectionViewLayout：</p>
<p>@interface MyLayout : UICollectionViewLayout</p>
<p>@end<br>对于.m文件的内容，前几篇博客中我们都是在prepareLayout中进行布局的静态设置，那是因为我们前几篇博客中的布局都是静态的，布局并不会随着我们的手势操作而发生太大的变化，因此我们全部在prepareLayout中一次配置完了。而我们这次要讨论的布局则不同，pickerView会随着我们手指的拖动而进行滚动，因此UICollectionView中的每一个item的布局是在不断变化的，所以这次，我们采用动态配置的方式，在layoutAttributesForItemAtIndexPath方法中进行每个item的布局属性设置。</p>
<p>至于layoutAttributesForItemAtIndexPath方法，它也是UICollectionViewLayout类中的方法，用于我们自定义时进行重写，至于为什么动态布局要在这里面配置item的布局属性，后面我们会了解到。</p>
<p>在编写我们的布局类之前，先做好准备工作，在viewController中，实现如下代码：</p>
<ul>
<li>(void)viewDidLoad {<br>[super viewDidLoad];<br>// Do any additional setup after loading the view, typically from a nib.<br>MyLayout <em> layout = [[MyLayout alloc]init];<br>UICollectionView </em> collect  = [[UICollectionView alloc]initWithFrame:CGRectMake(0, 0, 320, 400) collectionViewLayout:layout];<br>collect.delegate=self;<br>collect.dataSource=self;<br>[collect registerClass:[UICollectionViewCell class] forCellWithReuseIdentifier:@”cellid”];<br>[self.view addSubview:collect];<br>}</li>
</ul>
<p>-(NSInteger)numberOfSectionsInCollectionView:(UICollectionView <em>)collectionView{<br>return 1;<br>}<br>-(NSInteger)collectionView:(UICollectionView </em>)collectionView numberOfItemsInSection:(NSInteger)section{<br>return 10;<br>}<br>-(UICollectionViewCell <em>)collectionView:(UICollectionView </em>)collectionView cellForItemAtIndexPath:(NSIndexPath <em>)indexPath{<br>UICollectionViewCell </em> cell  = [collectionView dequeueReusableCellWithReuseIdentifier:@”cellid” forIndexPath:indexPath];<br>cell.backgroundColor = [UIColor colorWithRed:arc4random()%255/255.0 green:arc4random()%255/255.0 blue:arc4random()%255/255.0 alpha:1];<br>UILabel * label = [[UILabel alloc]initWithFrame:CGRectMake(0, 0, 250, 80)];<br>label.text = [NSString stringWithFormat:@”我是第%ld行”,(long)indexPath.row];<br>[cell.contentView addSubview:label];<br>return cell;<br>}<br>上面我创建了10个Item，并且在每个Item上添加了一个标签，标写是第几行。</p>
<p>在我们自定义的布局类中重写layoutAttributesForElementsInRect，在其中返回我们的布局数组：</p>
<p>-(NSArray<uicollectionviewlayoutattributes *=""> <em>)layoutAttributesForElementsInRect:(CGRect)rect{<br>NSMutableArray </em> attributes = [[NSMutableArray alloc]init];<br>//遍历设置每个item的布局属性<br>for (int i=0; i&lt;[self.collectionView numberOfItemsInSection:0]; i++) {<br>[attributes addObject:[self layoutAttributesForItemAtIndexPath:[NSIndexPath indexPathForItem:i inSection:0]]];<br>}<br>return attributes;<br>}<br>之后，在我们布局类中重写layoutAttributesForItemAtIndexPath方法：</uicollectionviewlayoutattributes></p>
<p>-(UICollectionViewLayoutAttributes <em>)layoutAttributesForItemAtIndexPath:(NSIndexPath </em>)indexPath{<br>//创建一个item布局属性类<br>UICollectionViewLayoutAttributes <em> atti = [UICollectionViewLayoutAttributes layoutAttributesForCellWithIndexPath:indexPath];<br>//获取item的个数<br>int itemCounts = (int)[self.collectionView numberOfItemsInSection:0];<br>//设置每个item的大小为260</em>100<br>atti.size = CGSizeMake(260, 100);<br>/*<br>后边介绍的代码添加在这里</p>
<p>*/<br>return atti;<br>}<br>上面的代码中，我们什么都没有做，下面我们一步步来实现3D的滚轮效果。</p>
<p>首先，我们先将所有的item的位置都设置为collectionView的中心：</p>
<p>atti.center = CGPointMake(self.collectionView.frame.size.width/2, self.collectionView.frame.size.height/2);<br>这时，如果我们运行程序的话，所有item都将一层层贴在屏幕的中央，如下：</p>
<p>很丑对吧，之后我们来设置每个item的3D效果,在上面的布局方法中添加如下代码:</p>
<p>//创建一个transform3D类<br>//CATransform3D是一个类似矩阵的结构体<br>//CATransform3DIdentity创建空得矩阵<br>CATransform3D trans3D = CATransform3DIdentity;<br>//这个值设置的是透视度，影响视觉离投影平面的距离<br>trans3D.m34 = -1/900.0;<br>//下面这些属性 后面会具体介绍<br>//这个是3D滚轮的半径<br>CGFloat radius = 50/tanf(M_PI<em>2/itemCounts/2);<br>//计算每个item应该旋转的角度<br>CGFloat angle = (float)(indexPath.row)/itemCounts</em>M_PI*2;<br>//这个方法返回一个新的CATransform3D对象，在原来的基础上进行旋转效果的追加<br>//第一个参数为旋转的弧度，后三个分别对应x，y，z轴，我们需要以x轴进行旋转<br>trans3D = CATransform3DRotate(trans3D, angle, 1.0, 0, 0);<br>//进行设置<br>atti.transform3D = trans3D;<br>对于上面的radius属性，运用了一些简单的几何和三角函数的知识。如果我们将系统的pickerView沿着y轴旋转90°，你会发现侧面的它是一个规则的正多边形，这里的radius就是这个多边形中心到其边的垂直距离，也是内切圆的半径，所有的item拼成了一个正多边形，示例如下：</p>
<p>通过简单的数学知识，h/2弦对应的角的弧度为2*pi/(边数)/2，在根据三角函数相关知识可知，这个角的正切值为h/2/radius，这就是我们radius的由来。 </p>
<p>对于angle属性，它是每一个item的x轴旋转度数，如果我们将所有item的中心都放在一点，通过旋转让它们散开如下图所示：</p>
<p>每个item旋转的弧度就是其索引/(2*pi)。</p>
<p>通过上面的设置，我们再运行代码，效果如下：</p>
<p>仔细观察我们可以发现，item以x中轴线进行了旋转平均布局，侧面的效果就是我们上面的简笔画那样，下面要进行我们的第三步了，将这个item，全部沿着其Z轴向前拉，就可以成为我们滚轮的效果，示例图如下：</p>
<p>我们继续在刚才的代码后面添加这行代码：</p>
<p>//这个方法也返回一个transform3D对象，追加平移效果，后面三个参数，对应平移的x，y，z轴，我们沿z轴平移<br>trans3D = CATransform3DTranslate(trans3D, 0, 0, radius);<br>再次运行，效果如下：</p>
<p>布局的效果我们已经完成了，离成功很近了对吧，只是现在的布局是静态的，我们不能滑动这个滚轮，我们还需要用动态滑动做一些处理。</p>
<p>三、让滚轮滑动起来</p>
<p>通过上面的努力，我们已经静态布局出了一个类似pickerView的滚轮，现在我们再来添加滑动滚动的效果</p>
<p>首先，我们需要给collectionView一个滑动的范围，我们以一屏collectionView的滑动距离来当做滚轮滚动一下的参照，我们在布局类中的如下方法中返回滑动区域：</p>
<p>-(CGSize)collectionViewContentSize{<br>return CGSizeMake(self.collectionView.frame.size.width, self.collectionView.frame.size.height*[self.collectionView numberOfItemsInSection:0]);<br>}<br>这时我们的collectionView已经可以进行滑动，但是并不是我们想要的效果，滚轮并没有滚动，而是随着滑动出了屏幕，因此，我们需要在滑动的时候不停的动态布局，将滚轮始终固定在collectionView的中心，先需要在布局类中实现如下方法：</p>
<p>//返回yes，则一有变化就会刷新布局<br>-(BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds{<br>return YES;</p>
<p>}<br>将上面的布局的中心点设置加上一个动态的偏移量：</p>
<p>atti.center = CGPointMake(self.collectionView.frame.size.width/2, self.collectionView.frame.size.height/2+self.collectionView.contentOffset.y);<br>现在在运行，会发现滚轮会随着滑动始终固定在中间，但是还是不如人意，滚轮并没有转动起来，我们还需要动态的设置每个item的旋转角度，这样连续看起来，滚轮就转了起来，在上面设置布局的方法中，我们在添加一些处理：</p>
<p>//获取当前的偏移量<br>float offset = self.collectionView.contentOffset.y;<br>//在角度设置上，添加一个偏移角度<br>float angleOffset = offset/self.collectionView.frame.size.height;<br>CGFloat angle = (float)(indexPath.row+angleOffset)/itemCounts<em>M_PI</em>2;<br>再看看效果，没错，就是这么简单，滚轮已经转了起来。</p>
<p>四、让其循环滚动的逻辑</p>
<p>我们再进一步，如果滚动可以循环，这个控件将更加炫酷，添加这样的逻辑也很简单，通过监测scrollView的偏移量，我们可以对齐进行处理，因为collectionView继承于scrollView，我们可以直接在ViewController中实现其代理方法，如下：</p>
<p>-(void)scrollViewDidScroll:(UIScrollView <em>)scrollView{<br>//小于半屏 则放到最后一屏多半屏<br>if (scrollView.contentOffset.y&lt;200) {<br>scrollView.contentOffset = CGPointMake(0, scrollView.contentOffset.y+10</em>400);<br>//大于最后一屏多一屏 放回第一屏<br>}else if(scrollView.contentOffset.y&gt;11<em>400){<br>scrollView.contentOffset = CGPointMake(0, scrollView.contentOffset.y-10</em>400);<br>}<br>}<br>因为咱们的环状布局，上面的逻辑刚好可以无缝对接，但是会有新的问题，一开始运行，滚轮就是出现在最后一个item的位置，而不是第一个，并且有些相关的地方，我们也需要一些适配：</p>
<p>在viewController中：</p>
<p>//一开始将collectionView的偏移量设置为1屏的偏移量<br>collect.contentOffset = CGPointMake(0, 400);<br>在layout类中：</p>
<p>//将滚动范围设置为(item总数+2)<em>每屏高度<br>-(CGSize)collectionViewContentSize{<br>return CGSizeMake(self.collectionView.frame.size.width, self.collectionView.frame.size.height</em>([self.collectionView numberOfItemsInSection:0]+2));<br>}<br>//将计算的具体item角度向前递推一个<br>CGFloat angle = (float)(indexPath.row+angleOffset-1)/itemCounts<em>M_PI</em>2;<br>OK，我们终于大功告成了，可以发现，实现这样一个布局效果炫酷的控件，代码其实并没有多少，相比，数学逻辑要比编写代码本身困难，这十分类似数学中的几何问题，如果你弄清了逻辑，解决是分分钟的事，我们可以通过这样的一个思路，设计更多3D或者平面特效的布局方案，抽奖的转动圆盘，书本的翻页，甚至立体的标签云，UICollectionView都可以实现，这篇博客中的代码在下面的连接中，疏漏之处，欢迎指正！</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2015/06/24/collectionView/">
    <time datetime="2015-06-23T20:21:26.000Z" class="entry-date">
        2015-06-24
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-runtime机制" class="post-runtime机制 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2015/06/12/runtime机制/">runtime机制</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2015/06/12/runtime机制/" data-id="cipc7059s00025fs6ztc7jx13" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p><span></span></p>
<p></p><h1><br></h1><br>Runtime是一套底层的C语言API（包含强大的C语言数据类型和函数）<br>OC代码都是基于Runtime实现的，即编写的OC代码最终都会转成Runtime的代码，例如：<br>HCPerson *person = [HCPerson alloc] init];<br>[person setAge:10]; //这句会转换成objc_msgSend(person,@selector(setAge:),20);<br>Runtime的作用<br>获取类的私有变量<p></p>
<p>#import <objc runtime.h=""><br>// Ivar : 成员变量<br>unsigned int count = 0;<br>// 获得所有的成员变量<br>Ivar <em>ivars = class_copyIvarList([HCPerson class], &amp;count);<br>for (int i = 0; i&lt;count; i++) {<br>// 取得i位置的成员变量<br>Ivar ivar = ivars[i];<br>const char </em>name = ivar_getName(ivar);<br>const char *type = ivar_getTypeEncoding(ivar);<br>NSLog(@”%d %s %s”, i, name, type);</objc></p>
<p>}<br>动态产生类，成员变量和方法<br>动态修改类，成员变量和方法<br>对换两个方法的实现（swizzle）</p>
<p>例如：如果想要对iOS7以上和iOS7以下的图片进行适配，不同系统版本显示不同的图片，则可利用swizzle来实现<br>实现方法：<br>1.自定义UIImage的类imageWithName：方法，在该方法内进行系统版本号的判断，来显示不同的图片<br>2.将imageWithName:方法和系统的imageNamed:方法进行对换，这样，一旦调用系统的imageNamed:方法，便会执行自定义的imageWithName:方法，进行判断，显示不同的图片<br>/**</p>
<ul>
<li>只要分类被装载到内存中，就会调用1次<br>*/</li>
</ul>
<ul>
<li><p>(void)load<br>{<br>//获取类方法<br>Method otherMehtod = class_getClassMethod(self, @selector(imageWithName:));<br>Method originMehtod = class_getClassMethod(self, @selector(imageNamed:));<br>// 交换2个方法的实现<br>method_exchangeImplementations(otherMehtod, originMehtod);<br>}</p>
</li>
<li><p>(UIImage <em>)imageWithName:(NSString </em>)name<br>{<br>BOOL iOS7 = [[UIDevice currentDevice].systemVersion floatValue] &gt;= 7.0;<br>UIImage <em>image = nil;<br>if (iOS7) {<br>NSString </em>newName = [name stringByAppendingString:@”_os7”];<br>image = [UIImage imageWithName:newName];<br>}</p>
</li>
</ul>
<p>if (image == nil) {<br>image = [UIImage imageWithName:name];<br>}<br>return image;<br>}</p>
<p>文／冲破茧缚（简书作者）<br>原文链接：<a href="http://www.jianshu.com/p/20a02d17d6fc" target="_blank" rel="external">http://www.jianshu.com/p/20a02d17d6fc</a><br>著作权归作者所有，转载请联系作者获得授权，并标注“简书作者”。<br></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2015/06/12/runtime机制/">
    <time datetime="2015-06-12T05:45:08.000Z" class="entry-date">
        2015-06-12
    </time>
</a>
    
    
    </footer>
</article>






  
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2016/06/12/ios视频直播开发/">ios视频直播开发</a>
          </li>
        
          <li>
            <a href="/2016/05/25/ios毛玻璃的实现/">ios毛玻璃的实现</a>
          </li>
        
          <li>
            <a href="/2016/05/25/音频直播的难点总结/">音频直播的难点总结</a>
          </li>
        
          <li>
            <a href="/2015/10/01/菜鸟成神宝典/">菜鸟成神宝典</a>
          </li>
        
          <li>
            <a href="/2015/09/24/如何做一个面霸/">如何做一个面霸</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  
    
  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2016 风
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>